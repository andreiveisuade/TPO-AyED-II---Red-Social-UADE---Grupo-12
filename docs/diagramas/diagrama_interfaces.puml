@startuml Interfaces y Clases Principales
!theme plain
skinparam linetype ortho
skinparam packageStyle rectangle

title **Diagrama de Clases Simplificado**\nRelaciones principales del sistema

' ==========================================
' MODELO - Sesion (Centro del sistema)
' ==========================================
class Sesion <<Singleton>> {
    - {static} instancia: Sesion
    - usuarioActual: Cliente
    - estaAutenticado: boolean
    - historial: HistorialAcciones
    __
    + {static} getInstancia(): Sesion
    + iniciarSesion(cliente: Cliente): void
    + cerrarSesion(): void
    + estaAutenticado(): boolean
    + getUsuarioActual(): Cliente
    + getHistorial(): HistorialAcciones
    + tieneSolicitudesPendientes(): boolean
    + getCantidadSolicitudesPendientes(): int
}

' ==========================================
' MODELO - Cliente
' ==========================================
class Cliente {
    + {static} MAX_SEGUIDOS: int = 2
    - id: int
    - nombre: String
    - scoring: int
    - siguiendo: Diccionario<Integer, Boolean>
    - solicitudesPendientes: Cola<SolicitudSeguimiento>
    __
    + seguir(idObjetivo: int): boolean
    + dejarDeSeguir(idObjetivo: int): boolean
    + recibirSolicitud(solicitud: SolicitudSeguimiento): void
    + procesarSiguienteSolicitud(): SolicitudSeguimiento
    + getCantidadSolicitudesPendientes(): int
    - validarLimiteSeguidores(): boolean
}

' ==========================================
' SERVICIO - GestorClientes
' ==========================================
class GestorClientes {
    - clientes: Diccionario<Integer, Cliente>
    - proximoId: int
    __
    + agregarCliente(nombre: String, scoring: int): int
    + buscarPorId(id: int): Cliente
    + buscarPorNombre(nombre: String): Cliente[]
    + buscarPorScoring(scoring: int): Cliente[]
    + eliminarCliente(id: int): boolean
    __
    <color:blue>Uso de Singleton Sesion:</color>
    + seguir(idSol: int, idObj: int): boolean
    + dejarDeSeguir(idSol: int, idObj: int): boolean
    + deshacer(): Accion
    + activarHistorial(): void
}

' ==========================================
' SERVICIO - HistorialAcciones
' ==========================================
class HistorialAcciones {
    - historial: Pila<Accion>
    __
    + registrar(accion: Accion): void
    + extraerUltima(): Accion
    + verUltima(): Accion
    + estaVacio(): boolean
    + getCantidad(): int
    + obtenerTodas(): Accion[]
}

' ==========================================
' PERSISTENCIA
' ==========================================
class JsonLoader {
    + cargarClientes(ruta: String): Cliente[]
}

' ==========================================
' RELACIONES
' ==========================================
Sesion *-- "1" Cliente : usuarioActual
Sesion *-- "1" HistorialAcciones : historial


Cliente *-- "1" "Cola<SolicitudSeguimiento>" : solicitudesPendientes
Cliente *-- "1" "Diccionario" : siguiendo

GestorClientes o-- "*" Cliente : gestiona
GestorClientes ..> Sesion : "accede via getInstancia()"

' ==========================================
' NOTAS
' ==========================================
note bottom of GestorClientes
    <b>Patrón Facade:</b>
    Centraliza la lógica de negocio.
    Usa Sesion.getInstancia() para
    registrar acciones en el historial.
end note

note right of Sesion
    <b>Singleton:</b>
    Garantiza una única sesión
    accesible globalmente.
    Dueña del historial de deshacer.
end note

@enduml
